import {useState} from 'react'
import {
  Alert,
  Button,
  Card,
  CardBody,
  Nav,
  NavItem,
  NavLink,
  Spinner,
  TabContent,
  TabPane,
} from 'reactstrap'
import {Link, useHistory, useParams} from 'react-router-dom'
import {Box2, Users} from 'components/icon'
import {Link2} from 'react-feather'

// *** Components
import IntroduceExploitedDetail from './../common-detail/Introduce'
import TopicExploitedDetail from './TopicExploitedDetail'
import {
  ListUidDataTable,
  StatisticDetailGroupPage,
  BreadcrumdDetailGroup,
  PostExploitedsDataTable,
  ExploiteCustomerLeadsQuery,
} from '@services/exploite-customer-leads'

// ** assets
import image from 'assets/media/avatars/default_group.jpg'

const GroupExploitedDetailPage = () => {
  // ** query
  const [active, setActive] = useState('1')
  const {groupId} = useParams()
  const history = useHistory()

  const {
    data: groupInfo,
    isLoading,
    isError,
  } = ExploiteCustomerLeadsQuery.useGroupExploitedInfo(groupId)
  const toggle = tab => {
    if (active !== tab) {
      setActive(tab)
    }
  }

  if (isLoading) {
    return (
      <div className="w-100 text-center">
        <Button color="flat-primary">
          <Spinner color="primary" size="sm" type="grow" />
          <span className="ml-5 text-primary">Loading...</span>
        </Button>
      </div>
    )
  }

  if (isError) {
    return (
      <div className="w-50">
        <Alert color="warning tex-center">
          <span className="alert-heading ">
            Hiện tại không tìm thấy dữ liệu
          </span>
        </Alert>
        <Button.Ripple
          color="warning"
          outline
          className=" mt-2"
          onClick={() => history.goBack()}
        >
          Quay trở lại
        </Button.Ripple>
      </div>
    )
  }

  let data = groupInfo.data || {}

  return (
    <Card>
      {/* breadcrumb */}
      <BreadcrumdDetailGroup group_name={data.group_name} />

      {/* menu khai thác khách hàng tiềm năng */}
      <CardBody className="pt-2 ">
        <div className="card mb-xl-2">
          <div className="card-body pt-2   pb-0">
            <div className="d-flex flex-wrap flex-sm-nowrap mb-3">
              <div className=" mb-1">
                <div className="symbol symbol-100px symbol-lg-160px symbol-fixed position-relative">
                  <div style={{height: 160, width: '160px'}}>
                    <img
                      src={data.group_avatar ? data.group_avatar : image}
                      alt=""
                      className="w-100 rounded"
                    />
                  </div>
                </div>
              </div>

              <div className="flex-grow-1">
                <div className="d-flex justify-content-between align-items-start flex-wrap mb-2">
                  <div className="d-flex flex-column">
                    <div className="d-flex align-items-center mb-2">
                      <div
                        className="text-gray-800  fs-2 fw-bolder mr-1  text-primary"
                        style={{cursor: 'context-menu'}}
                      >
                        {data.group_name || 'Chưa có dữ liệu'}
                      </div>
                    </div>
                    {data.group_link && (
                      <div className="mb-3 ">
                        <a
                          href={`https://${data.group_link}`}
                          className="text-danger "
                          target="_blank"
                          rel="noreferrer"
                        >
                          <Link2 className="mr-1 text-primary " size={15} />
                          {data.group_link}
                        </a>
                      </div>
                    )}

                    <div className="d-flex flex-wrap fw-bold fs-6 pe-2">
                      <Link
                        to="#"
                        className="d-flex align-items-center text-gray-400 text-hover-primary mr-5 mb-2"
                        style={{cursor: 'context-menu'}}
                      >
                        <Box2 className="mr-1" />
                        {data.is_public ? 'Nhóm công khai' : 'Nhóm kín'}
                      </Link>
                      <Link
                        to="#"
                        className="d-flex align-items-center text-gray-400 text-hover-primary mr-5 mb-2"
                        style={{cursor: 'context-menu'}}
                      >
                        <Users className="mr-1" />
                        {data.c_uid} thành viên
                      </Link>
                      <Link
                        to="#"
                        className="d-flex align-items-center text-gray-400 text-hover-primary mr-5 mb-2"
                        style={{cursor: 'context-menu'}}
                      >
                        <span className="svg-icon svg-icon-4 mr-1">
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            xmlnsXlink="http://www.w3.org/1999/xlink"
                            width="24px"
                            height="24px"
                            viewBox="0 0 24 24"
                            version="1.1"
                          >
                            <g
                              stroke="none"
                              strokeWidth={1}
                              fill="none"
                              fillRule="evenodd"
                            >
                              <rect x={0} y={0} width={24} height={24} />
                              <path
                                d="M5,10.5 C5,6 8,3 12.5,3 C17,3 20,6.75 20,10.5 C20,12.8325623 17.8236613,16.03566 13.470984,20.1092932 C12.9154018,20.6292577 12.0585054,20.6508331 11.4774555,20.1594925 C7.15915182,16.5078313 5,13.2880005 5,10.5 Z M12.5,12 C13.8807119,12 15,10.8807119 15,9.5 C15,8.11928813 13.8807119,7 12.5,7 C11.1192881,7 10,8.11928813 10,9.5 C10,10.8807119 11.1192881,12 12.5,12 Z"
                                fill="#000000"
                                fillRule="nonzero"
                              />
                            </g>
                          </svg>
                        </span>
                        {data.location}
                      </Link>
                    </div>
                    <div>
                      <span className="text-gray-400"> Từ khóa nổi bật:</span>
                      {Array.isArray(data.hot_key) ? (
                        data.hot_key?.length > 0 &&
                        data.hot_key.map(ele => (
                          <span
                            key={ele}
                            className="btn btn-sm btn-light-success fw-bolder ml-2 fs-8 py-1 px-3"
                          >
                            {ele}
                          </span>
                        ))
                      ) : (
                        <span className="btn btn-sm btn-light-success fw-bolder ml-2 fs-8 py-1 px-3">
                          {data.hot_key}
                        </span>
                      )}
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <Nav tabs>
              <NavItem>
                <NavLink
                  className="border-0"
                  active={active === '1'}
                  onClick={() => {
                    toggle('1')
                  }}
                >
                  Tổng quan
                </NavLink>
              </NavItem>
              <NavItem>
                <NavLink
                  className="border-0"
                  active={active === '2'}
                  onClick={() => {
                    toggle('2')
                  }}
                >
                  Giới thiệu
                </NavLink>
              </NavItem>
              <NavItem>
                <NavLink
                  className="border-0"
                  active={active === '3'}
                  onClick={() => {
                    toggle('3')
                  }}
                >
                  Chủ đề
                </NavLink>
              </NavItem>
              <NavItem>
                <NavLink
                  className="border-0"
                  active={active === '4'}
                  onClick={() => {
                    toggle('4')
                  }}
                >
                  Danh sách uid
                </NavLink>
              </NavItem>
            </Nav>
            <TabContent className="py-50" activeTab={active}>
              <TabPane tabId="1">
                <StatisticDetailGroupPage
                  statistic={data.statistic || {}}
                  updateTime={data.update_time}
                />
                <h3 className="text-info">Danh sách các bài viết của nhóm:</h3>
                <PostExploitedsDataTable
                  params={{type: 'group', value: data.id}}
                />
              </TabPane>
              <TabPane tabId="2">
                <IntroduceExploitedDetail
                  about={data.about}
                  visible={data.visible}
                  type={data.type}
                  is_public={data.is_public}
                  location={data.location}
                />
              </TabPane>
              <TabPane tabId="3">
                <TopicExploitedDetail topics={data.topics} />
              </TabPane>
              <TabPane tabId="4">
                <ListUidDataTable type="group" id={groupId} />
              </TabPane>
            </TabContent>
          </div>
        </div>
      </CardBody>
    </Card>
  )
}

export default GroupExploitedDetailPage
