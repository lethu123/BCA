import {useState} from 'react'
import {
  Alert,
  Breadcrumb,
  BreadcrumbItem,
  Button,
  Card,
  CardBody,
  Nav,
  NavItem,
  NavLink,
  Spinner,
  TabContent,
  TabPane,
} from 'reactstrap'
import {Link, useHistory, useParams} from 'react-router-dom'
import {Link2, MapPin} from 'react-feather'
import {Box2, Users} from 'components/icon'

// ** asset
import image from 'assets/media/avatars/default_group.jpg'

// *** Components
import {
  StatisticDetailGroupPage,
  PostExploitedsDataTable,
  BreadcrumbDetailFanpage,
} from '@services/exploite-customer-leads'
import IntroduceExploitedDetail from '../common-detail/Introduce'

// *** Query
import {useFanpageExploitedInfo} from 'hook/customer/customerHook'

const FanpageExploitedDetailPage = () => {
  const [active, setActive] = useState('1')
  const {fanpageId} = useParams()
  const history = useHistory()

  const {
    data: fanpageInfo,
    isLoading,
    isError,
  } = useFanpageExploitedInfo(fanpageId)

  const toggle = tab => {
    if (active !== tab) {
      setActive(tab)
    }
  }

  if (isLoading) {
    return (
      <div className="w-100 text-center">
        <Button color="flat-primary">
          <Spinner color="primary" size="sm" type="grow" />
          <span className="ml-5 text-primary">Loading...</span>
        </Button>
      </div>
    )
  }

  if (isError || !fanpageInfo || !(fanpageInfo && fanpageInfo.id)) {
    return (
      <div className="w-50">
        <Alert color="warning tex-center">
          <span className="alert-heading ">
            Hiện tại không tìm thấy dữ liệu
          </span>
        </Alert>
        <Button.Ripple
          color="warning"
          outline
          className=" mt-2"
          onClick={() => history.goBack()}
        >
          Quay trở lại
        </Button.Ripple>
      </div>
    )
  }

  let data = fanpageInfo || {}

  return (
    <Card>
      <BreadcrumbDetailFanpage fanpageId={fanpageId} />

      {/* menu khi thác khách hàng tiềm năng */}
      <CardBody className="pt-5 ">
        <div className="card mb-5 mb-xl-10">
          <div className="card-body pt-9 pb-0">
            <div className="d-flex align-items-center flex-wrap flex-sm-nowrap mb-3">
              <div className="me-7 mb-4">
                <div className="symbol symbol-100px symbol-lg-160px symbol-fixed position-relative">
                  <div style={{height: 160, width: '160px'}}>
                    <img
                      src={data.fanpage_avatar ? data.fanpage_avatar : image}
                      alt=""
                      className="w-100 rounded"
                      onError={e => {
                        e.target.onerror = null
                        e.target.src = image
                      }}
                    />
                  </div>
                </div>
              </div>

              <div className="flex-grow-1">
                <div className="d-flex justify-content-between align-items-start flex-wrap mb-2">
                  <div className="d-flex flex-column">
                    <div className="d-flex align-items-center mb-2">
                      <Link
                        to="#"
                        className="text-gray-800 text-hover-primary fs-2 fw-bolder me-1"
                      >
                        {data.fanpage_name}
                      </Link>
                    </div>
                    <div className="mt-2 mb-3 ">
                      <Link2 className="mr-1" size={12} />
                      <a
                        href={data.fanpage_link}
                        className="text-primary cursor-pointer"
                        target="_blank"
                        rel="noreferrer"
                      >
                        {data.fanpage_link}
                      </a>
                    </div>
                    <div className="d-flex flex-wrap fw-bold fs-6 mb-4 pe-2">
                      <p
                        className="mr-4 d-flex align-items-center text-primary  me-5 mb-2"
                        style={{cursor: 'context-menu'}}
                      >
                        <Box2 className="me-1 mr-1" color="primary" />
                        {data.is_public ? 'Fanpage công khai' : 'Fanpage kín'}
                      </p>
                      <p
                        className="mr-4 d-flex align-items-center text-primary me-5 mb-2"
                        style={{cursor: 'context-menu'}}
                      >
                        <Users className="me-1 mr-1" color="primary" />
                        {data.c_like} like
                      </p>
                      <p
                        className="d-flex align-items-center text-primary   mb-2"
                        style={{cursor: 'context-menu'}}
                      >
                        {/* <MapPin color="primary" size={17} /> */}
                        <MapPin size={15} className="mr-1" />
                        {data.location}
                      </p>
                    </div>
                    <div
                      style={{
                        display: data.hot_key?.length > 0 ? 'block' : 'none',
                      }}
                    >
                      <span className="text-gray-400"> Từ khóa nổi bật:</span>
                      {Array.isArray(data.hot_key) ? (
                        data.hot_key?.length > 0 &&
                        data.hot_key.map(ele => (
                          <span
                            key={ele}
                            className="btn btn-sm btn-light-success fw-bolder ms-2 fs-8 py-1 px-3"
                          >
                            {ele}
                          </span>
                        ))
                      ) : (
                        <span className="btn btn-sm btn-light-success fw-bolder ms-2 fs-8 py-1 px-3">
                          {data.hot_key}
                        </span>
                      )}
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <Nav tabs>
              <NavItem>
                <NavLink
                  className="border-0"
                  active={active === '1'}
                  onClick={() => {
                    toggle('1')
                  }}
                >
                  Tổng quan
                </NavLink>
              </NavItem>
              <NavItem>
                <NavLink
                  className="border-0"
                  active={active === '2'}
                  onClick={() => {
                    toggle('2')
                  }}
                >
                  Giới thiệu
                </NavLink>
              </NavItem>
            </Nav>
            <TabContent className="py-50" activeTab={active}>
              <TabPane tabId="1">
                <StatisticDetailGroupPage
                  statistic={data.statistic || {}}
                  updateTime={data.update_time}
                />
                <h3 className="my-3 text-info">
                  Danh sách các bài viết của fanpage:
                </h3>
                <PostExploitedsDataTable
                  params={{type: 'fanpage', value: data.id}}
                />
              </TabPane>
              <TabPane tabId="2">
                <IntroduceExploitedDetail
                  about={data.about}
                  visible={data.visible}
                  type={data.type}
                  is_public={data.is_public}
                  location={data.location}
                />
              </TabPane>
            </TabContent>
          </div>
        </div>
      </CardBody>
    </Card>
  )
}

export default FanpageExploitedDetailPage
